<?php
namespace AppBundle\Entity\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * RaceBookRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class DocumentRepository extends EntityRepository {

    /**
     * 
     * @param int $id_documnet
     * @param int $id_user
     * @return object
     */
    public function getDataByDocumenteAndUser($id_documnet, $id_user){
       
        $q = $this->createQueryBuilder('d')
             ->leftJoin('d.users', 'u')
             ->andWhere('u.id = :id_user')
             ->andWhere('d.id = :id_document')
             ->setParameter('id_user', $id_user)
             ->setParameter('id_document', $id_documnet) ;
                
        return $q->getQuery()->getResult();         
    }
    
    /**
     * 
     * @param string $s_name
     * @return object
     */
    public function getDocumentAllByFilter($s_name = '')
    {
        $q = $this->createQueryBuilder('d')
             ->orderBy('d.createdAt');
        
        if($s_name != ''){
            $q->andWhere("d.name LIKE '%".$s_name."%' ");
        }
        
        return $q->getQuery()->getResult();   
    }
    
    /**
     * 
     * @param int $user_id
     * @return object
     */
    public function getDocumentByUserId($user_id)
    {
         $q = $this->createQueryBuilder('d')
             ->leftJoin('d.users', 'u')
             ->andWhere('u.id = :id_user')
             ->andWhere('d.enable = :yes')
             ->setParameter('yes', true)
             ->setParameter('id_user', $user_id)
         ;
             
         
         return $q->getQuery()->getResult();
        
    }     
    
    
}